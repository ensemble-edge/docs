---
title: "Auto-Discovery"
description: "Automatic page discovery with Vite and Hot Module Replacement"
---

## Overview

Conductor automatically discovers pages from your `pages/` directory at build time using Vite + Rolldown. No manual imports or registration required.

## How It Works

1. **Build Time Scanning**: Vite plugin scans `pages/` for `page.yaml` files
2. **Virtual Module**: Generates `virtual:conductor-pages` with all discovered pages
3. **Zero Config**: Pages are automatically available - just create them
4. **HMR Support**: Instant updates during development when pages change

## Benefits

- **3-16x Faster Builds**: Rolldown bundler written in Rust
- **Zero Maintenance**: No manual imports to maintain
- **Type Safe**: Full TypeScript support with virtual module declarations
- **Developer Experience**: Instant feedback with Hot Module Replacement

## Directory Structure

```
pages/
├── examples/
│   ├── index/
│   │   ├── page.yaml
│   │   ├── handler.ts (optional)
│   │   └── template.liquid
│   ├── dashboard/
│   │   ├── page.yaml
│   │   └── template.liquid
│   └── blog-post/
│       ├── page.yaml
│       └── template.liquid
├── errors/
│   ├── 404/
│   │   ├── page.yaml
│   │   └── template.liquid
│   └── 500/
│       ├── page.yaml
│       └── template.liquid
└── static/
    ├── robots/
    │   └── page.yaml
    └── sitemap/
        └── page.yaml
```

## Configuration

### vite.config.ts

```typescript
import { defineConfig } from 'vite'
import { pageDiscoveryPlugin } from './scripts/vite-plugin-page-discovery.js'

export default defineConfig({
  plugins: [
    pageDiscoveryPlugin({
      pagesDir: 'pages', // default
      configFileName: 'page.yaml', // default
    }),
  ],
  // ... rest of config
})
```

### package.json Scripts

```json
{
  "scripts": {
    "build": "vite build",
    "dev": "vite dev",
    "deploy": "npm run build && wrangler deploy"
  }
}
```

### wrangler.toml

```toml
main = "dist/index.js"

[build]
command = "npm run build"
watch_dirs = ["src", "pages", "members", "ensembles"]
```

## Usage

### Using Discovered Pages

Import the virtual module in your worker:

```typescript
import { pages as discoveredPages } from 'virtual:conductor-pages'

// Pages are already parsed and ready
discoveredPages.forEach((page) => {
  console.log(page.name, page.config, page.handler)
})
```

### Type Definitions

Add type declarations for the virtual module:

```typescript
// src/vite-env.d.ts
declare module 'virtual:conductor-pages' {
  export interface DiscoveredPage {
    /** Page name */
    name: string
    /** Raw YAML config string */
    config: string
    /** Page handler module (if exists) */
    handler?: any
  }

  /** Map of page name to page data */
  export const pagesMap: Map<string, DiscoveredPage>

  /** Array of all discovered pages */
  export const pages: DiscoveredPage[]
}
```

## Creating a New Page

1. **Create page directory**:
   ```bash
   mkdir -p pages/my-page
   ```

2. **Create page.yaml**:
   ```yaml
   name: my-page
   type: Page
   description: My new page

   route:
     path: /my-page
     methods: [GET]

   template:
     engine: liquid
     path: template.liquid
   ```

3. **Create template**:
   ```liquid
   <!DOCTYPE html>
   <html>
   <head>
     <title>{{ title }}</title>
   </head>
   <body>
     <h1>Hello from my new page!</h1>
   </body>
   </html>
   ```

4. **Done!** The page is automatically discovered and available.

## Hot Module Replacement

During development, changes to pages trigger instant updates:

- **Add Page**: Automatically discovered and available
- **Modify Page**: Config/template updates reflected immediately
- **Delete Page**: Automatically removed from routing
- **Add Handler**: Handler imports updated automatically

Start development server:

```bash
npm run dev
```

Edit any file in `pages/` and see instant updates without restart.

## Advanced: Custom Discovery

### Filtering Pages

```typescript
// scripts/vite-plugin-page-discovery.ts
export function pageDiscoveryPlugin(options = {}) {
  return {
    name: 'conductor:page-discovery',
    // ...
    load(id) {
      if (id === RESOLVED_VIRTUAL_MODULE_ID) {
        const allPages = discoverPages()

        // Filter pages based on environment
        const filteredPages = allPages.filter(page => {
          if (process.env.NODE_ENV === 'production') {
            return !page.name.includes('test')
          }
          return true
        })

        return generateModule(filteredPages)
      }
    }
  }
}
```

### Priority-Based Loading

```typescript
// Sort pages by priority for optimal loading
const sortedPages = discoveredPages.sort((a, b) => {
  const getPriority = (name: string) => {
    if (name === 'index') return 100
    if (name.includes('error')) return 90
    return 50
  }
  return getPriority(b.name) - getPriority(a.name)
})
```

## Migration from Manual Imports

### Before (Manual)

```typescript
// src/index.ts - Manual imports
import indexPageConfigRaw from '../pages/examples/index/page.yaml'
import dashboardPageConfigRaw from '../pages/examples/dashboard/page.yaml'
import loginPageConfigRaw from '../pages/examples/login/page.yaml'

const pagesMap = new Map([
  ['index', { config: parseYAML(indexPageConfigRaw), ... }],
  ['dashboard', { config: parseYAML(dashboardPageConfigRaw), ... }],
  ['login', { config: parseYAML(loginPageConfigRaw), ... }],
])
```

### After (Auto-Discovery)

```typescript
// src/index.ts - Automatic discovery
import { pages as discoveredPages } from 'virtual:conductor-pages'

const pagesMap = new Map(
  discoveredPages.map((page) => [
    page.name,
    { config: parseYAML(page.config), ... }
  ])
)
```

**Benefits**:
- Remove 50+ lines of manual imports
- Add new pages without code changes
- No merge conflicts on imports
- Cleaner, more maintainable code

## Performance

### Build Times

Comparison on a project with 20 pages:

| Bundler | Build Time | Speedup |
|---------|------------|---------|
| Rollup  | 12.4s      | 1x      |
| Vite (esbuild) | 4.1s | 3x |
| **Vite + Rolldown** | **2.8s** | **4.4x** |

### Production Bundle

Auto-discovery has **zero runtime overhead**:

- Pages embedded as strings at build time
- No filesystem access required
- Same bundle size as manual imports
- Optimal for edge deployments

## Troubleshooting

### Pages Not Found

Check that:
1. `page.yaml` exists in each page directory
2. `pagesDir` config matches your directory name
3. Build completed successfully (`npm run build`)

### Type Errors on Virtual Module

Ensure `vite-env.d.ts` is included in your `tsconfig.json`:

```json
{
  "include": ["src/**/*", "src/vite-env.d.ts"]
}
```

### HMR Not Working

1. Verify `watch_dirs` in `wrangler.toml` includes `pages`
2. Check Vite dev server is running (`npm run dev`)
3. Look for errors in browser console

## See Also

- [Templates Guide](/conductor/guides/templates) - Working with page templates
- [Routing Guide](/conductor/routing/overview) - Configure page routes
- [Performance Guide](/conductor/guides/performance) - Optimize your builds
